<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <script type="module" src="./common.js"></script>

    <script type="module">
      import '@vaadin/dashboard';
      import '@vaadin/button';

      const dashboard = document.querySelector('vaadin-dashboard');

      dashboard.addEventListener('items-changed', (e) => {
        console.log('Items changed', JSON.stringify(e.detail.value));
      });

      const randomLayoutButton = document.getElementById('random');
      randomLayoutButton.addEventListener('click', () => {
        // TODO: Strart view transition internally on items change
        dashboard.__startViewTransition(() => {
          dashboard.items = [...dashboard.items]
            .sort(() => Math.random() - 0.5)
            .map((item, index) => {
              item.colspan = Math.floor(Math.random() * 2) + 1;
              item.rowspan = Math.floor(Math.random() * 1.5) + 1;
              return item;
            });
        });
      });

      const applySavedLayoutButton = document.getElementById('apply-saved');
      applySavedLayoutButton.addEventListener('click', () => {
        // A layout fetched from a db for example
        const items = [
          {
            colspan: 3,
            rowspan: 1,
            title: 'Title 1',
            content: 'Content 1',
            id: 'w1',
          },
          { colspan: 1, rowspan: 2, title: 'Title 2', content: 'Content 2', id: 'w2' },
          { colspan: 2, rowspan: 1, title: 'Title 3', content: 'Content 3', id: 'w3' },
          { colspan: 1, rowspan: 1, title: 'Title 4', content: 'Content 4', id: 'w4' },
          { colspan: 1, rowspan: 1, title: 'Title 5', content: 'Content 5', id: 'w5' },
        ];

        // The developer also needs to create the widgets (based on the data)
        dashboard.textContent = '';
        items.forEach((item) => {
          const widget = document.createElement('vaadin-dashboard-widget');
          Object.assign(widget, item);
          dashboard.appendChild(widget);
        });

        dashboard.items = items;
      });

      const appendWidgetButton = document.getElementById('append');
      appendWidgetButton.addEventListener('click', () => {
        const widget = document.createElement('vaadin-dashboard-widget');
        widget.id = 'w' + (dashboard.items.length + 1);
        widget.title = 'Title ' + (dashboard.items.length + 1);
        widget.textContent = 'Content ' + (dashboard.items.length + 1);
        dashboard.appendChild(widget);

        dashboard.items = [...dashboard.items, { id: widget.id }];
      });

      dashboard.items = [
        { id: 'w1' },
        { id: 'w2', colspan: 2 },
        { section: [{ id: 'w3' }, { id: 'w4', colspan: 2 }, { id: 'w5' }], title: 'Section title' },
        { id: 'w6', rowspan: 2 },
        { id: 'w7' },
      ];
    </script>
  </head>

  <body>
    <div style="display: flex; gap: 20px">
      <vaadin-button id="random">Randomize layout</vaadin-button>

      <vaadin-button id="apply-saved">Apply saved layout</vaadin-button>

      <vaadin-button id="append">Append widget</vaadin-button>
    </div>

    <vaadin-dashboard dense>
      <vaadin-dashboard-widget style="background-color: #ffb3ba" title="First title" id="w1">
        First content
      </vaadin-dashboard-widget>
      <vaadin-dashboard-widget style="background-color: #ffdfba" title="Second title" id="w2">
        Second content
      </vaadin-dashboard-widget>
      <vaadin-dashboard-widget style="background-color: #ffffba" title="Third title" id="w3">
        Third content
      </vaadin-dashboard-widget>
      <vaadin-dashboard-widget style="background-color: #baffc9" title="Fourth title" id="w4">
        Fourth content
      </vaadin-dashboard-widget>
      <vaadin-dashboard-widget style="background-color: #bae1ff" title="Fifth title" id="w5">
        Fifth content
      </vaadin-dashboard-widget>
      <vaadin-dashboard-widget style="background-color: #ffb3ba" title="Sixth title" id="w6">
        Sixth content
      </vaadin-dashboard-widget>
      <vaadin-dashboard-widget style="background-color: #ffdfba" title="Seventh title" id="w7">
        Seventh content
      </vaadin-dashboard-widget>
    </vaadin-dashboard>
  </body>
</html>

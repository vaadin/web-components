<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script type="module" src="./common.js"></script>
  </head>
  <body>
    <script type="module">
      import '@vaadin/grid/all-imports';

      const gridItems = Array.from({ length: 100 }, (_, i) => ({ name: `Item ${i}` }));

      function getItemsRange(items, [startItem, endItem]) {
        const startIndex = items.findIndex((item) => item === startItem);
        const endIndex = items.findIndex((item) => item === endItem);
        return items.slice(Math.min(startIndex, endIndex), Math.max(startIndex, endIndex) + 1);
      }

      {
        const grid = document.querySelector('vaadin-grid.gmail');
        grid.items = gridItems;

        let startItem;

        grid.addEventListener('item-selection', (event) => {
          const { item, selected, shiftKey } = event.detail;

          startItem ??= item;
          if (shiftKey) {
            getItemsRange(grid.items, [startItem, item]).forEach((rangeItem) => {
              if (selected) {
                grid.selectItem(rangeItem);
              } else {
                grid.deselectItem(rangeItem);
              }
            })
          }
          startItem = item;
        });
      }

      {
        const grid = document.querySelector('vaadin-grid.addon');
        grid.items = gridItems;

        let startItem;

        grid.addEventListener('item-selection', (event) => {
          const { item, selected, shiftKey } = event.detail;

          startItem ??= item;
          if (selected) {
            if (shiftKey) {
              grid.selectedItems = [...getItemsRange(grid.items, [startItem, item])];
              return;
            }

            grid.selectedItems = [item];
            startItem = item;
          } else {
            if (shiftKey && startItem !== item) {
              grid.selectedItems = [...getItemsRange(grid.items, [startItem, item])];
              return;
            }

            grid.selectedItems = [];
            startItem = null;
          }
        });
      }
    </script>

    <div style="display: flex; gap: 20px;">
      <vaadin-grid item-id-path="name" style="height: 800px" class="gmail">
        <vaadin-grid-selection-column auto-select></vaadin-grid-selection-column>
        <vaadin-grid-column header="Gmail behavior" path="name"></vaadin-grid-column>
      </vaadin-grid>

      <vaadin-grid item-id-path="name" style="height: 800px" class="addon">
        <vaadin-grid-selection-column auto-select hidden></vaadin-grid-selection-column>
        <vaadin-grid-column header="Addon behavior" path="name"></vaadin-grid-column>
      </vaadin-grid>
    </div>
  </body>
</html>

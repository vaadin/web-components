<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aura</title>
    <link rel="stylesheet" href="../packages/aura/aura.css" />
    <link rel="stylesheet" href="../packages/aura/src/icons.css" />
    <script type="module">
      window.Vaadin ||= {};
      window.Vaadin.featureFlags ||= {};
      window.Vaadin.featureFlags.masterDetailLayoutComponent = true;

      import './aura-color-control.js';
      import './aura-inset-control.js';
      import './aura-number-control.js';
      import './aura-scheme-control.js';
      import '@vaadin/avatar';
      import '@vaadin/app-layout';
      import '@vaadin/app-layout/vaadin-drawer-toggle.js';
      import '@vaadin/button';
      import '@vaadin/card';
      import '@vaadin/checkbox';
      import '@vaadin/checkbox-group';
      import '@vaadin/icon';
      import '@vaadin/grid/all-imports';
      import '@vaadin/form-layout';
      import '@vaadin/master-detail-layout';
      import '@vaadin/number-field';
      import '@vaadin/select';
      import '@vaadin/scroller';
      import '@vaadin/side-nav';
      import '@vaadin/text-field';
      import '@vaadin/horizontal-layout';
      import '@vaadin/vertical-layout';
      import { html, render } from 'lit';
      import { Button } from '@vaadin/button';
      import { Notification } from '@vaadin/notification';

      const notification = Notification.show(
        html`<vaadin-card theme="horizontal footer-end no-frame">
          <vaadin-icon icon="lucide:chat" slot="media"></vaadin-icon>
          <div slot="title">New Message from Olivia</div>
          <div>The AI chat UI is evolving with the integration of componentsâ€¦</div>
          <vaadin-button slot="footer">Show</vaadin-button>
          <vaadin-button slot="footer">Dismiss</vaadin-button>
        </vaadin-card>`,
        { duration: 0, position: 'top-end' },
      );
      notification._overlayElement
        .querySelectorAll('vaadin-button')
        .forEach((button) => button.addEventListener('click', () => notification.close()));

      const generateItems = (count) => {
        return Array.from({ length: count }, (_, i) => ({
          name: `First Lastname ${i + 1}`,
          email: `first.lastname${i + 1}@example.com`,
          address: `${i + 1} Main Street`,
          city: `City ${i + 1}`,
          country: `Country ${i + 1}`,
        }));
      };

      const mdl = document.querySelector('vaadin-master-detail-layout > vaadin-master-detail-layout');
      const detailView = document.querySelector('#detail-view').content.firstElementChild.cloneNode(true);
      detailView.addEventListener('click', (e) => {
        if (e.target.localName === 'vaadin-button') {
          grid.activeItem = null;
        }
      });

      mdl.addEventListener('backdrop-click', () => {
        grid.activeItem = null;
      });

      // const grid = document.querySelector('vaadin-grid');
      // grid.items = generateItems(100);

      // grid.addEventListener('active-item-changed', (e) => {
      //   const item = e.detail.value;
      //   if (item) {
      //     mdl._setDetail(detailView);
      //   } else {
      //     mdl._setDetail(null);
      //   }
      //   // This triggers the cell part generator
      //   grid.selectedItems = [];
      // });

      // grid.cellPartNameGenerator = (column, model) => {
      //   let parts = 'nav-item';
      //   if (model.item === grid.activeItem) {
      //     parts += ' active-nav-item';
      //   }
      //   return parts;
      // };

      customElements.define(
        'mdl-back-button',
        class extends Button {
          connectedCallback() {
            super.connectedCallback();
            this.setAttribute('theme', 'tertiary');
            const icon = document.createElement('vaadin-icon');
            icon.setAttribute('icon', 'lucide:arrow-back');
            this.append(icon);
            this.addEventListener('click', () => {
              const inner = this.closest('vaadin-master-detail-layout');
              const outer = inner.parentNode.closest('vaadin-master-detail-layout');
              outer?._setDetail(null);
            });
          }
        },
      );

      // Fake navigation: prevent actual navigation, update 'current' item manually
      document.querySelectorAll('vaadin-side-nav').forEach((nav) =>
        nav.addEventListener('click', (e) => {
          const link = e.composedPath().find((el) => el.localName === 'a');
          if (link) {
            e.preventDefault();
            if (link.href) {
              link
                .getRootNode()
                .host.closest('vaadin-side-nav')
                .parentNode.querySelectorAll('vaadin-side-nav-item')
                .forEach((item) => item.removeAttribute('current'));
              const navItem = e.composedPath().find((el) => el.localName === 'vaadin-side-nav-item');
              navItem.setAttribute('current', '');
            }
          }
        }),
      );

      const orgSelect = document.querySelector('#org-select');
      orgSelect.renderer = (root) => {
        render(
          html`
            <vaadin-select-list-box>
              <vaadin-select-item value="vaadin">
                <vaadin-avatar
                  theme="vaadin square"
                  has-color-index
                  style="--vaadin-avatar-user-color: var(--aura-accent-color);"
                  tabindex="-1"
                ></vaadin-avatar>
                <span>Aura</span>
              </vaadin-select-item>
            </vaadin-select-list-box>
          `,
          root,
        );
      };
      orgSelect.value = 'vaadin';
    </script>
  </head>

  <body>
    <vaadin-app-layout primary-section="navbar">
      <header slot="drawer">
        <vaadin-select id="org-select" theme="subtle auto-size"></vaadin-select>
        <vaadin-button theme="tertiary">
          <vaadin-icon icon="lucide:panel-left-close"></vaadin-icon>
        </vaadin-button>
      </header>
      <vaadin-scroller slot="drawer" theme="overflow-indicators">
        <vaadin-side-nav collapsible>
          <span slot="label">General</span>

          <vaadin-side-nav-item path="">
            <vaadin-icon icon="lucide:chart-column" slot="prefix"></vaadin-icon>
            Dashboard
            <span theme="badge" slot="suffix" aria-label="(2 new items)">2</span>
          </vaadin-side-nav-item>

          <vaadin-side-nav-item path="projects">
            <vaadin-icon icon="lucide:layers" slot="prefix"></vaadin-icon>
            Projects
          </vaadin-side-nav-item>

          <vaadin-side-nav-item path="documents">
            <vaadin-icon icon="lucide:file-text" slot="prefix"></vaadin-icon>
            Documents
          </vaadin-side-nav-item>

          <vaadin-side-nav-item path="calendar">
            <vaadin-icon icon="lucide:calendar" slot="prefix"></vaadin-icon>
            Calendar
          </vaadin-side-nav-item>
        </vaadin-side-nav>

        <vaadin-side-nav collapsible>
          <span slot="label">Organization</span>

          <vaadin-side-nav-item path="reporting">
            <vaadin-icon icon="lucide:chart-pie" slot="prefix"></vaadin-icon>
            Reporting
          </vaadin-side-nav-item>

          <vaadin-side-nav-item path="tasks">
            <vaadin-icon icon="lucide:list-todo" slot="prefix"></vaadin-icon>
            Tasks
          </vaadin-side-nav-item>

          <vaadin-side-nav-item path="users">
            <vaadin-icon icon="lucide:users" slot="prefix"></vaadin-icon>
            Users
          </vaadin-side-nav-item>
        </vaadin-side-nav>
      </vaadin-scroller>
      <footer slot="drawer">
        <a href="">Sign in</a>
      </footer>

      <vaadin-master-detail-layout theme master-min-size="14em" detail-size="75%" detail-min-size="20em">
        <div class="aura-view">
          <header>
            <vaadin-drawer-toggle></vaadin-drawer-toggle>
            <h1>Dashboard</h1>
          </header>
          <vaadin-scroller theme="overflow-indicators">
            <vaadin-side-nav>
              <vaadin-side-nav-item path="">
                <vaadin-icon icon="lucide:home" slot="prefix"></vaadin-icon>
                <span>Home</span>
              </vaadin-side-nav-item>
              <vaadin-side-nav-item path="/">
                <vaadin-icon icon="lucide:chart-column" slot="prefix"></vaadin-icon>
                <span>Dashboard</span>
              </vaadin-side-nav-item>
              <vaadin-side-nav-item path="/">
                <vaadin-icon icon="lucide:folder" slot="prefix"></vaadin-icon>
                <span>Projects</span>
              </vaadin-side-nav-item>
              <vaadin-side-nav-item path="/">
                <vaadin-icon icon="lucide:chart-pie" slot="prefix"></vaadin-icon>
                <span>Reporting</span>
              </vaadin-side-nav-item>
              <vaadin-side-nav-item path="/">
                <vaadin-icon icon="lucide:gear" slot="prefix"></vaadin-icon>
                <span>Settings</span>
              </vaadin-side-nav-item><vaadin-side-nav-item path="/">
                <vaadin-icon icon="lucide:chat" slot="prefix"></vaadin-icon>
                <span>Support</span>
                <span theme="badge positive" slot="suffix">Online</span>
              </vaadin-side-nav-item>
            </vaadin-side-nav>
          </vaadin-scroller>
        </div>

        <vaadin-master-detail-layout slot="detail" containment="viewport" theme="surface" force-overlay>
          <div class="aura-view">
            <header>
              <mdl-back-button></mdl-back-button>
              <h1>Contacts</h1>
            </header>
            <!-- <vaadin-grid multi-sort column-reordering-allowed theme="no-border">
              <vaadin-grid-selection-column></vaadin-grid-selection-column>

              <vaadin-grid-column-group header="Personal Information">
                <vaadin-grid-sort-column path="name" header="Name"></vaadin-grid-sort-column>
                <vaadin-grid-sort-column path="email" header="Email"></vaadin-grid-sort-column>
              </vaadin-grid-column-group>

              <vaadin-grid-column-group header="Contact Information">
                <vaadin-grid-filter-column path="address" header="Address"></vaadin-grid-filter-column>
                <vaadin-grid-sort-column path="city" header="City"></vaadin-grid-sort-column>
                <vaadin-grid-sort-column path="country" header="Country"></vaadin-grid-sort-column>
              </vaadin-grid-column-group>

              <span slot="empty-state">No items</span>
            </vaadin-grid> -->
            <vaadin-scroller theme="overflow-indicators">
              <vaadin-vertical-layout theme="padding spacing">
                <vaadin-horizontal-layout theme="wrap">
                  <aura-scheme-control property="--aura-color-scheme" label="--aura-color-scheme"></aura-scheme-control>
                  <aura-scheme-control property="--aura-nav-color-scheme" label="--aura-nav-color-scheme"></aura-scheme-control>
                  <aura-scheme-control property="--aura-notification-color-scheme" label="--aura-notification-color-scheme"></aura-scheme-control>
                </vaadin-horizontal-layout>
                <vaadin-horizontal-layout theme="wrap">
                  <aura-number-control property="--aura-contrast" min="0" max="2" step="0.1"></aura-number-control>
                  <aura-number-control property="--aura-neutral-saturation" min="0" max="1" step="0.01"></aura-number-control>
                  <aura-inset-control></aura-inset-control>
                </vaadin-horizontal-layout>
                <vaadin-horizontal-layout theme="wrap">
                  <aura-color-control property="--aura-accent-light" label="--aura-accent-light"></aura-color-control>
                  <aura-color-control property="--aura-accent-dark" label="--aura-accent-dark"></aura-color-control>
                </vaadin-horizontal-layout>
                <vaadin-horizontal-layout theme="wrap">
                  <aura-color-control property="--aura-background-light" label="--aura-background-light"></aura-color-control>
                  <aura-color-control property="--aura-background-dark" label="--aura-background-dark"></aura-color-control>
                </vaadin-horizontal-layout>
              </vaadin-vertical-layout>
            </vaadin-scroller>
          </div>
        </vaadin-master-detail-layout>
      </vaadin-master-detail-layout>
    </vaadin-app-layout>

    <template id="detail-view">
      <div slot="detail" class="aura-view">
        <header>
          <mdl-back-button></mdl-back-button>
          <h3>My App</h3>
        </header>
        <vaadin-scroller theme="overflow-indicators">
          <vaadin-form-layout auto-responsive theme="padding">
            <vaadin-text-field label="Application Name" value="My App"></vaadin-text-field>
            <vaadin-text-field label="Image" value="my-app:latest"></vaadin-text-field>
            <vaadin-text-field label="Hostname" value="my-app.local">
              <span slot="prefix">https://</span>
            </vaadin-text-field>
            <vaadin-text-field label="Port" value="8080"></vaadin-text-field>
            <vaadin-checkbox label="Secure Connection" checked></vaadin-checkbox>
            <vaadin-number-field label="Replicas" step-buttons-visible value="1"></vaadin-number-field>
            <hr />
            <vaadin-checkbox-group label="Features">
              <vaadin-checkbox label="User Management" value="user-management" checked></vaadin-checkbox>
              <vaadin-checkbox label="Localization" value="localization"></vaadin-checkbox>
            </vaadin-checkbox-group>
          </vaadin-form-layout>
        </vaadin-scroller>
        <footer>
          <vaadin-button>Cancel</vaadin-button>
          <vaadin-button theme="primary">Save</vaadin-button>
        </footer>
      </div>
    </template>
  </body>
</html>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Upload</title>
    <script type="module" src="./common.js"></script>

    <script type="module">
      import '@vaadin/radio-group';
      import '@vaadin/upload';
      import { createFiles, xhrCreator } from '@vaadin/upload/test/helpers.js';

      const nextUpload = document.querySelector('#next-upload');

      const upload = document.querySelector('vaadin-upload');
      // Use a fake xhr for testing
      upload._createXhr = () => {
        if (nextUpload.value === 'successful') {
          return xhrCreator({ size: 512, uploadTime: 3000, stepTime: 1000 })();
        } else if (nextUpload.value === 'rejected') {
          return new XMLHttpRequest();
        } else if (nextUpload.value === 'error') {
          return xhrCreator({
            serverValidation: () => {
              return {
                statusText: 'Error',
              };
            },
          })();
        }
      };

      const getFiles = (n) =>
        new Array(n).fill().map((_, i) => {
          if (i % 2 === 0) {
            return { name: `File ${i}.pdf`, progress: 60 };
          }

          return { name: `File ${i}.pdf`, error: 'An error occurred' };
        });

      const files = getFiles(4000);

      const blobs = createFiles(files.length, 1000, 'application/unknown');

      files.forEach((_, index) => {
        files[index] = Object.assign(blobs[index], files[index]);
      });

      upload.files = files;
    </script>
  </head>

  <body>
    <vaadin-upload target="/api/fileupload"></vaadin-upload>
  </body>
</html>

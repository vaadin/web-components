<!--
@license
Vaadin App Layout
Copyright (C) 2018 Vaadin Ltd
This program is available under Commercial Vaadin Add-On License 3.0 (CVALv3).
See the file LICENSE.md distributed with this software for more information about licensing.
See <a href="https://vaadin.com/license/cval-3">the website</a> for the complete license.
-->

<link rel="import" href="../../polymer/polymer-element.html">
<link rel="import" href="../../vaadin-themable-mixin/vaadin-themable-mixin.html">
<link rel="import" href="../../vaadin-element-mixin/vaadin-element-mixin.html">
<link rel="import" href="../../vaadin-license-checker/vaadin-license-checker.html">

<dom-module id="vaadin-app-layout">
  <template>
    <style>
      :host {
        display: flex;
        flex-direction: column-reverse;
        height: 100%;
        width: 100%;
        top: 0;
        left: 0;
        position: fixed;
        bottom: var(--vaadin-app-layout-viewport-bottom);
        /* CSS API for host */
        --vaadin-overlay-viewport-bottom: 0;
      }

      :host([hidden]) {
        display: none !important;
      }

      [part="branding"] {
        display: none;
      }

      [part="navbar"] {
        flex: none;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      [part="menu"] {
        width: auto;
        overflow: hidden;
      }

      [part="content"] {
        flex: auto;
        overflow: auto;
        -webkit-overflow-scrolling: touch;
      }

      @media (min-width: 700px) {
        :host {
          flex-direction: column;
        }

        [part="branding"] {
          display: flex;
          position: absolute;
          left: 0;
          flex-basis: 0;
        }
      }
    </style>

    <div part="navbar">
      <div part="branding">
        <slot name="branding"></slot>
      </div>
      <div part="menu">
        <slot name="menu"></slot>
      </div>
      <div part="secondary">
        <slot name="secondary"></slot>
      </div>
    </div>
    <div part="content">
      <slot></slot>
    </div>

  </template>

  <script>
    (function() {

      /**
       * `<vaadin-app-layout>` is a Polymer 2 element.
       *
       * ```
       * <vaadin-app-layout></vaadin-app-layout>
       * ```
       *
       * @memberof Vaadin
       * @mixes Vaadin.ElementMixin
       * @mixes Vaadin.ThemableMixin
       * @demo demo/index.html
       */
      class AppLayoutElement extends Vaadin.ElementMixin(Vaadin.ThemableMixin(Polymer.Element)) {
        static get is() {
          return 'vaadin-app-layout';
        }
        static get version() {
          return '0.1.0';
        }

        constructor() {
          super();

          if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
            this._boundIosResizeListener = () => this._detectIosNavbar();
          }
        }

        connectedCallback() {
          super.connectedCallback();
          if (this._boundIosResizeListener) {
            this._detectIosNavbar();
            window.addEventListener('resize', this._boundIosResizeListener);
          }
        }

        _detectIosNavbar() {
          const innerHeight = window.innerHeight;
          const innerWidth = window.innerWidth;
          const landscape = innerWidth > innerHeight;
          const clientHeight = document.documentElement.clientHeight;
          if (landscape && clientHeight > innerHeight) {
            this.style.setProperty('--vaadin-app-layout-viewport-bottom', clientHeight - innerHeight + 'px');
          } else {
            this.style.setProperty('--vaadin-app-layout-viewport-bottom', '0');
          }
        }
      }

      customElements.define(AppLayoutElement.is, AppLayoutElement);

      /**
       * @namespace Vaadin
       */
      window.Vaadin.AppLayoutElement = AppLayoutElement;

      const licenseChecker = window.Vaadin.developmentModeCallback
        && window.Vaadin.developmentModeCallback['vaadin-license-checker'];
      if (typeof licenseChecker === 'function') {
        licenseChecker(AppLayoutElement);
      }
    })();
  </script>
</dom-module>

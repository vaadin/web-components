<!-- Common imports for all examples -->
<link rel="stylesheet" href="../../elements-demo-resources/demo.css">
<script src="../../elements-demo-resources/ga.js"></script>
<script src="../../mock-http-request/lib/mock.js"></script>

<!-- Common JS code for all examples -->
<script>
  window.xCodeExampleSourceHead =
  '  <script src="https://cdn.vaadin.com/vaadin-components/latest/webcomponentsjs/webcomponents-lite.js"><\/script>\n' +
  '  <link href="https://cdn.vaadin.com/vaadin-components/latest/vaadin-upload/vaadin-upload.html" rel="import">\n';

  var link = document.querySelector('link[href$="common.html"]');
  var baseCommon = link.href.replace(/common.html/, '');
  var bowerComponents = '../../';
  var base = baseCommon + bowerComponents;

  ['polymer/polymer.html',
    'code-example/code-example.html',
    'table-of-contents/table-of-contents.html',
    'vaadin-upload/vaadin-upload.html'
  ].forEach(function(path) {
    if (!document.querySelector('link[href$="' + path + '"]')) {
      var link = document.createElement('link');
      link.rel = 'import';
      link.href = base + path;
      document.head.appendChild(link);
    }
  });

  // Use MockHttpRequest in demos
  function mockXhrGenerator(file) {
    var xhr = new MockHttpRequest();
    xhr.upload = {};
    xhr.onsend = function() {
      var total = file && file.size ||Â 1024, done = 0;
      function start() {
        setTimeout(progress, 1000);
      }
      function progress() {
        xhr.upload.onprogress({total: total, loaded: done});
        if (done < total) {
          setTimeout(progress, 200);
          done = Math.min(total, done + 254000);
        } else {
          setTimeout(finish, 1000);
        }
      }
      function finish() {
        xhr.receive(200, '{"message":"OK"}');
      }
      start();
    };
    return xhr;
  }

  window.addEventListener('WebComponentsReady', function() {
    // Monkey-patch vaadin-upload prototype to use MockHttpRequest
    Object.getPrototypeOf(document.createElement('vaadin-upload'))._createXhr = mockXhrGenerator;
  });
</script>

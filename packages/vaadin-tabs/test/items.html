<!doctype html>

<head>
  <meta charset="UTF-8">
  <title>vaadin-tabs tests</title>
  <script src="../../web-component-tester/browser.js"></script>
  <script src="../../iron-test-helpers/mock-interactions.js"></script>
  <link rel="import" href="../vaadin-tab.html">
</head>

<body>
  <test-fixture id="navItem">
    <template>
      <vaadin-tab>
        text-content
      </vaadin-tab>
    </template>
  </test-fixture>

  <script>
    function spaceDown(target) {
      MockInteractions.keyDownOn(target, 32, [], ' ');
    }

    function spaceUp(target) {
      MockInteractions.keyUpOn(target, 32, [], ' ');
    }

    function space(target) {
      spaceDown(target);
      spaceUp(target);
    }

    function enter(target) {
      MockInteractions.keyDownOn(target, 13, [], 'Enter');
      MockInteractions.keyUpOn(target, 13, [], 'Enter');
    }

    function fire(target, type) {
      target.dispatchEvent(new CustomEvent(type, {composed: true, bubbles: true}));
    }

    describe('vaadin-tab', () => {
      var item;

      beforeEach(() => item = fixture('navItem'));

      it('should have a correct localName', () => {
        expect(item.localName).to.be.equal('vaadin-tab');
      });

      it('should have a correct role', () => {
        expect(item.getAttribute('role')).to.be.equal('tab');
      });

      it('should have an unnamed slot for content', () => {
        const slot = item.root.querySelector('slot:not([name])');
        const content = slot.assignedNodes()[0];
        expect(content.nodeType).to.be.equal(3);
        expect(content.textContent.trim()).to.be.equal('text-content');
      });

      it('should extend vaadin-list-item-mixin', () => {
        expect(item instanceof Vaadin.TabElement).to.be.true;
      });

      describe('vaadin-list-item-mixin', () => {
        beforeEach(() => {});

        it('should not have focused attribute when not focused', () => {
          expect(item.hasAttribute('focused')).to.be.false;
        });

        it('should have focused attribute when focused', () => {
          fire(item, 'focus');
          expect(item.hasAttribute('focused')).to.be.true;
        });

        it('should not have focused attribute when blurred', () => {
          fire(item, 'focus');
          fire(item, 'blur');
          expect(item.hasAttribute('focused')).to.be.false;
        });

        it('should have active attribute on mousedown', () => {
          fire(item, 'mousedown');
          expect(item.hasAttribute('active')).to.be.true;
          expect(item._mousedown).to.be.true;
        });

        it('should not have active attribute after mouseup', () => {
          fire(item, 'mousedown');
          fire(item, 'mouseup');
          expect(item.hasAttribute('active')).to.be.false;
          expect(item._mousedown).to.be.false;
        });

        it('should have active attribute on space down', () => {
          spaceDown(item);
          expect(item.hasAttribute('active')).to.be.true;
        });

        it('should not have active attribute after space up', () => {
          spaceDown(item);
          spaceUp(item);
          expect(item.hasAttribute('active')).to.be.false;
        });

        it('should not have focus-ring if not focused', () => {
          expect(item.hasAttribute('focus-ring')).to.be.false;
        });

        it('should not have focus-ring attribute when not focused with keyboard', () => {
          item.click();
          expect(item.hasAttribute('focus-ring')).to.be.false;
        });

        it('should have focus-ring attribute when focused with keyboard', () => {
          fire(item, 'focus');
          expect(item.hasAttribute('focus-ring')).to.be.true;
        });

        it('should not have focus-ring after blur', () => {
          fire(item, 'focus');
          fire(item, 'blur');
          expect(item.hasAttribute('focus-ring')).to.be.false;
        });

        it('set this._mousedown to false if mouseup was outside', () => {
          fire(item, 'mousedown');
          expect(item._mousedown).to.be.true;
          fire(document, 'mouseup');
          expect(item._mousedown).to.be.false;
        });

        it('should be selectable with mouse click', () => {
          item.click();
          expect(item.selected).to.be.true;
        });

        it('should be selectable with Enter key', () => {
          enter(item);
          expect(item.selected).to.be.true;
        });

        it('should be selectable with Space key', () => {
          space(item);
          expect(item.selected).to.be.true;
        });

        it('should have aria-disabled when disabled', () => {
          item.disabled = true;
          expect(item.getAttribute('aria-disabled')).to.equal('true');
          item.disabled = false;
          expect(item.getAttribute('aria-disabled')).to.be.null;
        });

        it('should be possible to unselect the current item', () => {
          item.click();
          item.click();
          expect(item.selected).to.be.false;
        });
      });
    });
  </script>
</body>

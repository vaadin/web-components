<!doctype html>

<head>
  <meta charset="UTF-8">
  <title>vaadin-tabs tests</title>
  <script src="../../web-component-tester/browser.js"></script>
  <script src="../../iron-test-helpers/mock-interactions.js"></script>
  <link rel="import" href="../vaadin-tab.html">
  <link rel="import" href="../vaadin-tabs.html">
</head>

<body>
  <test-fixture id="nav">
    <template>
      <vaadin-tabs style="width: 400px; height: 400px;">
        <vaadin-tab>Foo</vaadin-tab>
        <vaadin-tab>Bar</vaadin-tab>
        <separator>___</separator>
        <vaadin-tab disabled>Baz</vaadin-tab>
        <vaadin-tab>Baz</vaadin-tab>
      </vaadin-tabs>
    </template>
  </test-fixture>
  <script>
    const safari10 = /Apple.* Version\/(9|10)/.test(navigator.userAgent);

    describe('vaadin-tabs', () => {
      var nav;

      beforeEach(() => nav = fixture('nav'));

      it('should have a correct localName', () => {
        expect(nav.localName).to.equal('vaadin-tabs');
      });

      it('should have role="tablist"', () => {
        expect(nav.getAttribute('role')).to.equal('tablist');
      });

      it('`_navItems` should only contain vaadin-tabs', () => {
        expect(nav._navItems.length).to.equal(4);
        nav._navItems.forEach(item => {
          expect(item.tagName.toLowerCase()).to.equal('vaadin-tab');
        });
      });

      it('should not have attribute overflow when items fit in the viewport', function(done) {
        setTimeout(() => {
          expect(nav.hasAttribute('overflow')).to.be.false;
          done();
        }, 1);
      });

      ['horizontal', 'vertical'].forEach(orientation => {

        describe(`Overflow ${orientation}`, () => {

          beforeEach(() => nav.orientation = orientation);

          describe('In large viewport', () => {
            it(`when orientation=${orientation} should not have overflow`, function(done) {
              setTimeout(() => {
                expect(nav.hasAttribute('overflow')).to.be.false;
                done();
              }, 10);
            });
          });

          describe('In small viewport', () => {

            // these tests pass in latest Safari but fails in previous version
            if (safari10) {
              return;
            }

            beforeEach(done => {
              nav.style.width = '200px';
              nav.style.height = '100px';
              nav._updateOverflow();
              Polymer.RenderStatus.afterNextRender(this, done);
            });

            it(`when orientation=${orientation} should have overflow="end" if scroll is at the beginning`, done => {
              setTimeout(() => {
                expect(nav.getAttribute('overflow')).to.be.equal('end');
                done();
              }, 100);
            });

            it(`when orientation=${orientation} should have overflow="start end" if scroll is at the middle`, done => {
              const listener = nav._scrollerElement.addEventListener('scroll', () => {
                expect(nav.getAttribute('overflow')).to.be.equal('start end');
                nav._scrollerElement.removeEventListener('scroll', listener);
                done();
              });
              nav._scroll(2);
            });

            it(`when orientation=${orientation} should have overflow="start" if scroll is at the end`, done => {
              const listener = nav._scrollerElement.addEventListener('scroll', () => {
                expect(nav.getAttribute('overflow')).to.be.equal('start');
                nav._scrollerElement.removeEventListener('scroll', listener);
                done();
              });
              nav._scroll(400);
            });
          });

        });
      });
    });
  </script>
</body>

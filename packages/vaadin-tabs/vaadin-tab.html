<!--
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/mixins/gesture-event-listeners.html">
<link rel="import" href="../vaadin-themable-mixin/vaadin-themable-mixin.html">
<link rel="import" href="vaadin-nav-item-mixin.html">

<dom-module id="vaadin-tab-default-theme">
  <template>
    <style>
      /* TODO: Implement default theme. */
    </style>
  </template>
</dom-module>

<dom-module id="vaadin-tab">
  <template>
    <style>
      :host {
        display: inline-block;
        position: relative;
        outline: none;
        padding: 4px;
        border: 2px solid transparent;
        opacity: 0.7;
        cursor: pointer;
        white-space: nowrap;
        text-overflow: ellipsis;
      }

      [part="button"] {
        width: 100%;
        height: 100%;
        margin: 0;
        overflow: visible;
        border: none;
        display: flex;
        justify-content: center;
      }

      [part="close-button"] {
        position: absolute;
        top: 0;
        right: 0;

        border: solid 1px grey;
        border-radius: 50%;
        opacity: 0.6;
        width: 12px;
        height: 12px;
        line-height: 10px;
        font-size: 10px;
        display: flex;
        justify-content: center;
      }

      [part="close-button"]::before {
        content: "x";
      }

      :host([hidden]) {
        display: none;
      }

      :host([focused]) {
        border: 2px solid #03a9f4;
      }

      :host([active]) {
        background: #03a9f41f;
      }

      :host([selected]) {
        background: #03a9f44f;
      }

      :host([disabled]) {
        opacity: 0.3;
      }

      :host(:hover) {
        opacity: 1;
      }
    </style>
    <div id="button" type="button" part="button">
      <slot></slot>
      <div part="close-button" on-tap="_close" role="button"></div>
    </div>
  </template>
  <script>
    if (!Polymer.Element) {
      throw new Error(`Unexpected Polymer version ${Polymer.version} is used, expected v2.0.0 or later.`);
    }

    {
      /**
       * `<vaadin-tab>` is a Polymer 2 element providing an accessible and customizable tab.
       *
       * @memberof Vaadin
       * @mixes Vaadin.NavItemMixin
       * @mixes Vaadin.ThemableMixin
       * @mixes Polymer.GestureEventListeners
       */
      class TabElement extends Vaadin.NavItemMixin(Vaadin.ThemableMixin(Polymer.GestureEventListeners(Polymer.Element))) {
        static get is() {
          return 'vaadin-tab';
        }

        ready() {
          super.ready();

          // Leaving default role in the native button, makes navigation announcement
          // being different when using focus navigation (tab) versus using normal
          // navigation (arrows). The first way announces the label on a button
          // since the focus is moved programmatically, and the second on a group.
          this.setAttribute('role', 'button');
          this.$.button.setAttribute('role', 'presentation');
        }

        _close() {
          this.dispatchEvent(new CustomEvent('close', {bubbles: true, composed: true}));
        }
      }

      customElements.define(TabElement.is, TabElement);

      /**
       * @namespace Vaadin
       */
      window.Vaadin = window.Vaadin || {};
      Vaadin.TabElement = TabElement;
    }
  </script>
</dom-module>

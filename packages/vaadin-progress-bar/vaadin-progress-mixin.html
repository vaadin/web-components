<!--
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<script>
  window.Vaadin = window.Vaadin || {};
  /**
   * @polymerMixin
   */
  Vaadin.ProgressMixin = superClass =>
    class VaadinProgressMixin extends superClass {
      static get properties() {
        return {
          /**
           * Displays current progress
           */
          value: {
            type: Number,
            observer: '_valueChanged'
          },
          /**
           * Minimum bound of the progress bar. Cannot be greater than max.
           */
          min: {
            type: Number,
            value: 0,
            observer: '_minChanged'
          },
          /**
           * Maximum bound of the progress bar. Cannot be less than min.
           */
          max: {
            type: Number,
            value: 1,
            observer: '_maxChanged'
          }
        };
      }

      static get observers() {
        return [
          '_normalizedValueChanged(value, min, max)'
        ];
      }

      ready() {
        super.ready();

        this.setAttribute('tabindex', 0);
        this.setAttribute('role', 'progressbar');
      }

      _normalizedValueChanged(value, min, max) {
        this.updateStyles({
          '--vaadin-progress-value': String(this._normalizeValue(value, min, max))
        });
      }

      _valueChanged(newV, oldV) {
        this.setAttribute('aria-valuenow', this.value);
      }

      _minChanged(newV, oldV) {
        if (newV >= this.max) {
          try {
            throw new Error('min should be less then max');
          } finally {
            this.min = oldV;
          }
        }

        this.setAttribute('aria-valuemin', this.min);
      }

      _maxChanged(newV, oldV) {
        if (newV <= this.min) {
          try {
            throw new Error('min should be less then max');
          } finally {
            this.max = oldV;
          }
        }

        this.setAttribute('aria-valuemax', this.max);
      }

      /**
       * Percent of current progress relative to whole progress bar (max - min)
       */
      _normalizeValue(value, min, max) {
        if (!value && value != 0) {
          return;
        }

        var nV = (value - min) / (max - min);

        if (nV > 1) {
          nV = 1;
        } else if (nV < 0) {
          nV = 0;
        }

        return nV;
      }
    };
</script>

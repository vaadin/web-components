<link rel="import" href="../../../vaadin-valo-styles/color.html">
<link rel="import" href="../../../vaadin-valo-styles/sizing.html">
<link rel="import" href="../../../vaadin-valo-styles/spacing.html">
<link rel="import" href="../../../vaadin-valo-styles/style.html">
<link rel="import" href="../../../vaadin-valo-styles/typography.html">

<dom-module id="valo-text-field" theme-for="vaadin-text-field">
  <template>
    <style>
      :host {
        --valo-text-field-size: var(--valo-size-m);
        color: var(--valo-body-text-color);
        font-size: var(--valo-font-size-m);
        font-family: var(--valo-font-family);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        -webkit-tap-highlight-color: transparent;
      }

      :host::before {
        height: var(--valo-text-field-size);
        line-height: 1;
        padding-top: calc((var(--valo-text-field-size) - 1em) / 2);
        box-sizing: border-box;
        /* input-field margin-top */
        margin-top: var(--valo-space-xs);
      }

      [part="label"] {
        align-self: flex-start;
        color: var(--valo-secondary-text-color);
        font-weight: 500;
        font-size: var(--valo-font-size-s);
        margin-left: calc(var(--valo-border-radius) / 4);
        transition: color 0.2s;
        line-height: 1;
        height: calc(var(--valo-font-size-s) + var(--valo-space-xs));
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        position: relative;
        max-width: 100%;
        box-sizing: border-box;
      }

      :host([label])::before {
        /* Label height + input-field margin-top */
        margin-top: calc(var(--valo-font-size-s) + var(--valo-space-xs) * 2);
      }

      :host([label]) {
        margin-top: var(--valo-space-m);
      }

      :host([focused]:not([readonly])) [part="label"] {
        color: var(--valo-primary-text-color);
      }

      :host([required]) [part="label"] {
        padding-right: 1em;
      }

      /* Used for required and invalid indicators */
      [part="label"]::after {
        content: var(--valo-required-field-indicator, "•");
        transition: opacity 0.2s;
        opacity: 0;
        color: var(--valo-primary-text-color);
        position: absolute;
        right: 0;
        width: 1em;
        text-align: center;
      }

      [part="value"],
      [part="input-field"] ::slotted([part="value"]) {
        padding: 0 0.25em;
        --_valo-text-field-overflow-mask-image: linear-gradient(to left, transparent 0.25em, #000 1.5em);
        -webkit-mask-image: var(--_valo-text-field-overflow-mask-image);
        mask-image: var(--_valo-text-field-overflow-mask-image);
      }

      [part="value"]:focus {
        -webkit-mask-image: none;
        mask-image: none;
      }

      [part="value"]::-webkit-input-placeholder {
        color: inherit;
        transition: opacity 0.175s 0.05s;
        opacity: 0.5;
      }

      [part="value"]:-ms-input-placeholder {
        color: inherit;
        opacity: 0.5;
      }

      [part="value"]::-moz-placeholder {
        color: inherit;
        transition: opacity 0.175s 0.05s;
        opacity: 0.5;
      }

      [part="value"]::placeholder {
        color: inherit;
        transition: opacity 0.175s 0.1s;
        opacity: 0.5;
      }

      [part="input-field"] {
        margin: var(--valo-space-xs) 0;
        border-radius: var(--valo-border-radius);
        background-color: var(--valo-contrast-10pct);
        padding: 0 calc(0.375em + var(--valo-border-radius) / 4);
        font-weight: 500;
        line-height: 1;
        position: relative;
        height: var(--valo-text-field-size);
        cursor: text;
      }

      /* Used for hover and activation effects */
      [part="input-field"]::after {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        border-radius: inherit;
        pointer-events: none;
        background-color: var(--valo-contrast-50pct);
        opacity: 0;
        transition: transform 0.15s, opacity 0.2s;
        transform-origin: 100% 0;
        will-change: transform;
      }

      /* Hover */

      :host(:hover:not([readonly]):not([focused])) [part="label"] {
        color: var(--valo-body-text-color);
      }

      :host(:hover:not([readonly]):not([focused])) [part="input-field"]::after {
        opacity: 0.1;
      }

      /* Touch device adjustment */
      @media (pointer: coarse) {
        :host(:hover:not([readonly]):not([focused])) [part="label"] {
          color: var(--valo-secondary-text-color);
        }

        :host(:hover:not([readonly]):not([focused])) [part="input-field"]::after {
          opacity: 0;
        }

        :host(:active:not([readonly]):not([focused])) [part="input-field"]::after {
          opacity: 0.2;
        }
      }

      /* Trigger when not focusing using the keyboard */
      :host([focused]:not([focus-ring]):not([readonly])) [part="input-field"]::after {
        transform: scaleX(0);
        transition: transform 0.15s, opacity 1s;
      }

      /* Focus-ring */

      :host([focus-ring]) [part="input-field"] {
        box-shadow: 0 0 0 2px var(--valo-primary-color-50pct);
      }

      /* Read-only and disabled */

      :host([readonly]) [part="input-field"],
      :host([disabled]) [part="input-field"] {
        background-color: var(--valo-contrast-5pct);
      }

      /* Disabled style */

      :host([disabled]) {
        pointer-events: none;
      }

      :host([disabled]) [part="label"],
      :host([disabled]) [part="value"],
      :host([disabled]) [part="input-field"] ::slotted(*) {
        color: var(--valo-disabled-text-color);
        -webkit-text-fill-color: var(--valo-disabled-text-color);
      }

      :host([disabled]) [part="value"]::-webkit-input-placeholder {
        opacity: 0;
      }

      :host([disabled]) [part="value"]:-ms-input-placeholder {
        opacity: 0;
      }

      :host([disabled]) [part="value"]::-moz-placeholder {
        opacity: 0;
      }

      :host([disabled]) [part="value"]::placeholder {
        opacity: 0;
      }

      /* Required field style */

      :host([required]:not([has-value])) [part="label"]::after {
        opacity: 1;
      }

      /* Invalid style */

      :host([invalid]) [part="label"]::after {
        color: var(--valo-error-text-color);
      }

      :host([invalid]) [part="input-field"] {
        background-color: var(--valo-error-color-10pct);
      }

      :host([invalid]) [part="input-field"]::after {
        background-color: var(--valo-error-color-50pct);
      }

      :host([invalid][focus-ring]) [part="input-field"] {
        box-shadow: 0 0 0 2px var(--valo-error-color-50pct);
      }

      /* Error message */

      [part="error-message"] {
        margin-left: calc(var(--valo-border-radius) / 4);
        font-size: var(--valo-font-size-xs);
        line-height: var(--valo-line-height-xs);
        color: var(--valo-error-text-color);
        will-change: max-height;
        transition: 0.4s max-height;
        max-height: 5em;
      }

      /* Margin that doesn’t reserve space when there’s no error message */
      [part="error-message"]:not(:empty)::after {
        content: "";
        display: block;
        height: var(--valo-space-s);
      }

      :host(:not([invalid])) [part="error-message"] {
        max-height: 0;
        overflow: hidden;
      }

      /* Small theme */

      :host([theme~="small"]) {
        font-size: var(--valo-font-size-s);
        --valo-text-field-size: var(--valo-size-s);
      }

      :host([theme~="small"][label]) [part="label"] {
        font-size: var(--valo-font-size-xs);
      }

      :host([theme~="small"][label]) [part="error-message"] {
        font-size: var(--valo-font-size-xxs);
      }

      /* Text align */

      :host([theme~="align-center"]) [part="value"] {
        text-align: center;
        --_valo-text-field-overflow-mask-image: none;
      }

      :host([theme~="align-right"]) [part="value"] {
        text-align: right;
        --_valo-text-field-overflow-mask-image: none;
      }

      @-moz-document url-prefix() {
        /* Firefox is smart enough to align overflowing text to right */
        :host([theme~="align-right"]) [part="value"] {
          --_valo-text-field-overflow-mask-image: linear-gradient(to right, transparent 0.25em, #000 1.5em);
        }
      }

      /* Slotted content */

      [part="input-field"] ::slotted(:not([part="value"])) {
        color: var(--valo-secondary-text-color);
        font-weight: 400;
      }

      /* Slotted icons */

      [part="input-field"] ::slotted(iron-icon) {
        color: var(--valo-contrast-50pct);
        width: var(--valo-icon-size);
        height: var(--valo-icon-size);
      }

      /* Vaadin icons are based on a 16x16 grid (unlike Valo and Material icons with 24x24), so they look too big by default */

      [part="input-field"] ::slotted(iron-icon[icon^="vaadin:"]) {
        width: calc(var(--valo-icon-size) - 0.5em);
        height: calc(var(--valo-icon-size) - 0.5em);
        padding: 0.25em;
      }
    </style>
  </template>
</dom-module>

<link rel="import" href="../../src/vaadin-text-field.html">

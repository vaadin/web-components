<!--
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Commercial Vaadin Add-On License 3.0, available at http://vaadin.com/license/cval-3.
-->
<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../vaadin-themable-mixin/vaadin-themable-mixin.html">
<link rel="import" href="../../vaadin-grid/src/vaadin-grid-column.html">

<dom-module id="vaadin-crud-edit">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
  </template>

  <script>
    /**
     * `<vaadin-crud-edit>` is a helper element for `<vaadin-grid-column>` that provides
     * an easily themable button that fires an `edit` event with the row item as detail
     * when clicked.
     *
     * Typical usage is in a `<vaadin-grid-column>` of a custom `<vaadin-grid>` inside
     * a `<vaadin-crud>` to enable editing.
     */
    class CrudEditElement extends Vaadin.ThemableMixin(Polymer.Element) {
      static get is() {
        return 'vaadin-crud-edit';
      }

      /** @private */
      ready() {
        super.ready();
        this.addEventListener('click', this.__onClick);
        this.setAttribute('aria-label', 'Edit');
        this.setAttribute('role', 'button');
      }

      __onClick(e) {
        const tr = e.target.parentElement.assignedSlot.parentElement.parentElement;
        tr.dispatchEvent(
          new CustomEvent('edit', {detail: {item: tr._item, index: tr.index}, bubbles: true, composed: true}));
      }

      /**
       * Fired when user on the icon.
       *
       * @event edit
       * @param {Object} detail.item the item to edit
       * @param {Object} detail.index the index of the item in the data set
       */
    }
    window.customElements.define(CrudEditElement.is, CrudEditElement);
  </script>
</dom-module>

<dom-module id="vaadin-crud-edit-column">
  <template>
    <template class="header" id="defaultHeaderTemplate" aria-label="Edit">
    </template>
    <template id="defaultBodyTemplate">
      <div id="edit">Edit</div>
    </template>
  </template>

  <script>
  (function() {
    /**
     * `<vaadin-crud-edit-column>` is a helper element for the `<vaadin-grid>`
     * that provides a clickable and themable edit icon.
     *
     * Typical usage is in a custom `<vaadin-grid>` inside a `<vaadin-crud>`.
     *
     * #### Example:
     * ```html
     * <vaadin-grid items="[[items]]">
     *  <vaadin-crud-edit-column></vaadin-crud-edit-column>
     *
     *  <vaadin-grid-column>
     *    ...
     * ```
     *
     * @memberof Vaadin
     */
    class CrudEditColumnElement extends (class extends Vaadin.GridColumnElement {}) {

      static get is() {
        return 'vaadin-crud-edit-column';
      }

      static get properties() {
        return {
          /**
           * Width of the cells for this column.
           * @private
           */
          width: {
            type: String,
            value: '4em'
          },

          /**
           * Flex grow ratio for the cell widths. When set to 0, cell width is fixed.
           * @private
           */
          flexGrow: {
            type: Number,
            value: 0
          },

          /** The arial-label for the edit button */
          ariaLabel: String
        };
      }

      /** @private */
      ready() {
        super.ready();
        this.renderer = (root, column, model) => {
          if (!root.firstElementChild) {
            const elm = document.createElement('vaadin-crud-edit');
            this.hasAttribute('theme') && elm.setAttribute('theme', this.getAttribute('theme'));
            this.editLabel && elm.setAttribute('aria-label', this.ariaLabel);
            root.appendChild(elm);
          }
        };
      }
    }

    customElements.define(CrudEditColumnElement.is, CrudEditColumnElement);

    /**
     * @namespace Vaadin
     */
    window.Vaadin = window.Vaadin || {};
    Vaadin.CrudEditColumnElement = CrudEditColumnElement;
  })();
  </script>
</dom-module>

<link rel="import" href="vaadin-text-field.html">
<link rel="import" href="vaadin-overlay.html">
<link rel="import" href="vaadin-button.html">
<link rel="import" href="font-icons.html">

<dom-module id="valo-date-picker" theme-for="vaadin-date-picker">
  <template>
    <style>
      :host {
        -webkit-tap-highlight-color: transparent;
      }

      :host([label]) {
        margin-top: var(--valo-space-m);
        vertical-align: var(---vaadin-text-field-vertical-align-offset);
      }

      [part="text-field"] {
        display: block;
        max-width: 100%;
      }

      [part$="button"] {
        width: 24px;
        height: 24px;
        line-height: 24px;
        font-size: 24px;
        text-align: center;
        color: var(--valo-contrast-40pct);
        transition: 0.2s color;
      }

      [part$="button"]:hover {
        color: var(--valo-contrast-70pct);
      }

      [part$="button"]::before {
        font-family: "valo-icons";
      }

      [part="toggle-button"] {
        order: -1;
      }

      [part="toggle-button"]::before {
        content: "\e908";
      }

      [part="clear-button"]::before {
        content: "\e907";
      }

      /* Overlay width */

      [part="overlay"] {
        width: calc(var(--valo-size-m) * 10);
      }

      :host([show-week-numbers]) [part="overlay"]:not([fullscreen]) {
        width: calc(var(--valo-size-m) * 11);
      }

      [part="overlay"][fullscreen] {
        width: 100vw;
        height: 100vh;
      }

    </style>
  </template>
</dom-module>

<dom-module id="valo-month-calendar" theme-for="vaadin-month-calendar">
  <template>
    <style>
      :host {
        -moz-user-select: none;
        -ms-user-select: none;
        -webkit-user-select: none;
        user-select: none;
        font-size: var(--valo-font-size-m);
        color: var(--valo-body-text-color);
        text-align: center;
        /* Make the currently focused month be roughly in the center of the overlay */
        /* TODO expose the overlay max-height as a custom property, so it can be used in calc's */
        /* TODO this doesn’t work nicely with the infinite scroller buffers, as sometimes one buffer
         * will overlap the other, and the user can’t click on a date to select it. Using smaller
         * offset for now, and compensating it in the scroll item height */
        /*transform: translateY(calc(var(--valo-size-m) * 2));*/
        transform: translateY(var(--valo-size-s));
      }

      /* Disabled state */

      :host([disabled]) {
        color: var(--valo-disabled-text-color);
        cursor: default;
      }

      /* Month header */

      [part="month-header"] {
        color: var(--valo-header-text-color);
        font-size: var(--valo-font-size-l);
        line-height: 1;
        font-weight: 500;
        margin-bottom: var(--valo-space-m);
      }

      /* Week days and numbers */

      [part="weekdays"],
      [part="weekday"],
      [part="week-numbers"] {
        font-size: var(--valo-font-size-xs);
        line-height: 1;
        color: var(--valo-tertiary-text-color);
      }

      [part="weekdays"] {
        margin-bottom: var(--valo-space-s);
      }

      [part="week-numbers"] {
        width: var(--valo-size-s);
      }

      /* Date and week number cells */

      [part="date"],
      [part="week-number"] {
        box-sizing: border-box;
        height: var(--valo-size-m);
        line-height: var(--valo-size-m);
        position: relative;
      }

      @media (pointer: coarse) {
        [part="date"],
        [part="week-number"] {
          height: var(--valo-size-l);
          line-height: var(--valo-size-l);
        }
      }

      [part="date"]:not(:empty):not([disabled]) {
        cursor: pointer;
      }

      /* Today date */

      [part="date"][today] {
        color: var(--valo-primary-text-color);
      }

      /* Focused date */

      [part="date"][focused] {
        color: var(--valo-primary-contrast-color);
      }

      [part="date"][focused]::before,
      [part="date"][selected]::before {
        content: "";
        position: absolute;
        z-index: -1;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.85);
        transition: 0.16s transform cubic-bezier(.12, .32, .54, 2);
        will-change: transform;
        min-width: 2em;
        min-height: 2em;
        width: 80%;
        height: 80%;
        max-height: 100%;
        max-width: 100%;
        background-color: var(--valo-primary-color);
        border-radius: var(--valo-border-radius);
      }

      [part="date"][selected]:not([focused])::before {
        content: none;
      }

      :host([focused]) [part="date"][focused]::before {
        transform: translate(-50%, -50%);
      }

      @media (pointer: coarse) {
        [part="date"][focused]::before {
          content: none;
        }

        [part="date"][focused]:not([selected]) {
          color: inherit;
        }

        [part="date"][today]:not([selected]) {
          color: var(--valo-primary-text-color);
        }

        [part="date"][selected]::before {
          content: "";
        }
      }
    </style>
  </template>
</dom-module>
<dom-module id="valo-date-picker-overlay" theme-for="vaadin-date-picker-overlay">
  <template>
    <style>
      :host {
        /* TODO should use vaadin-overlay styles eventually, now just copy pasted from there */
        background-color: var(--valo-base-color);
        border-radius: var(--valo-overlay-border-radius, var(--valo-border-radius));
        box-shadow: var(--valo-overlay-box-shadow);
        box-sizing: border-box;
        animation: 0.2s vaadin-overlay-enter;
        font-family: var(--valo-font-family);

        max-height: calc(var(--valo-size-m) * 14);

        /* Background for the year scroller, placed here as we are using a mask image on the actual years part */
        background-image: linear-gradient(var(--valo-shade-5pct), var(--valo-shade-5pct));
        background-size: 57px 100%;
        background-position: top right;
        background-repeat: no-repeat;
      }

      /* Month scroller */

      [part="months"] {
        /* TODO this property should support calc or measure the height from the DOM */
        /*--vaadin-infinite-scroller-item-height: calc(var(--valo-size-l) * 6 + var(--valo-font-size-l) + var(--valo-space-m) + var(--valo-font-size-xs) + var(--valo-space-s) + var(--valo-size-s));*/
        --vaadin-infinite-scroller-item-height: 301px;
        -webkit-mask-image: linear-gradient(transparent, #000 10%, #000 85%, transparent);
        mask-image: linear-gradient(transparent, #000 10%, #000 85%, transparent);
        bottom: calc(var(--valo-size-m) + var(--valo-space-m));
        height: auto;
      }

      @media (pointer: coarse) {
        :host {
          max-height: calc(var(--valo-size-l) * 14);
        }

        [part="months"] {
          /*--vaadin-infinite-scroller-item-height: calc(var(--valo-size-m) * 6 + var(--valo-font-size-l) + var(--valo-space-m) + var(--valo-font-size-xs) + var(--valo-space-s) + var(--valo-size-s));*/
          --vaadin-infinite-scroller-item-height: 349px;
        }
      }

      [part="month"][disabled] {
        opacity: 0.3;
      }

      /* Year scroller */

      [part="years"] {
        --vaadin-infinite-scroller-buffer-width: 97px;
        width: 57px;
        font-size: var(--valo-font-size-s);
        cursor: pointer;
        box-shadow: inset 2px 0 4px 0 var(--valo-shade-5pct);
        -webkit-mask-image: linear-gradient(transparent, #000 35%, #000 65%, transparent);
        mask-image: linear-gradient(transparent, #000 35%, #000 65%, transparent);
      }

      [part="year-number"],
      [part="year-separator"]{
        opacity: 0.5;
        transition: 0.2s opacity;
      }

      [part="years"]:hover [part="year-number"],
      [part="years"]:hover [part="year-separator"] {
        opacity: 1;
      }


      /* TODO unsupported selector, should fix this in vaadin-date-picker that it adapts to the
       * width of the year scroller */
      #scrollers[desktop] [part="months"] {
        right: 57px;
      }

      /* Year scroller position indicator */
      [part="years"]::before {
        border: none;
        width: 1em;
        height: 1em;
        background-color: var(--valo-base-color);
        transform: translate(-75%, -50%) rotate(45deg);
        border-top-right-radius: calc(var(--valo-border-radius) / 2);
        box-shadow: 2px -2px 6px 0 var(--valo-shade-5pct);
        z-index: 1;
      }

      [part="year-number"],
      [part="year-separator"] {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 50%;
        transform: translateY(-50%);
      }

      [part="years"] [part="year-separator"]::after {
        color: var(--valo-disabled-text-color);
        content: "•";
      }

      /* Current year */

      [part="years"] [part="year-number"][current] {
        color: var(--valo-primary-text-color);
      }

      /* Toolbar (footer) */

      [part="toolbar"] {
        padding: var(--valo-space-wide-s);
        box-shadow: 0 -1px 0 0 var(--valo-contrast-10pct);
        background-color: var(--valo-base-color);
        position: absolute;
        right: 57px;
        left: 0;
        bottom: 0;
        border-bottom-left-radius: var(--valo-border-radius);
      }

      @supports (mask-image: linear-gradient(#000, #000)) or (-webkit-mask-image: linear-gradient(#000, #000)) {
        [part="toolbar"] {
          box-shadow: none;
        }
      }

      /* Today and Cancel buttons */

      /* TODO: Would be great if I could apply the "tertiary" theme from here instead of copying
       * those styles */
      /* TODO: It’s not possible to adjust the padding inside the buttons, so we have to use
       * negative margins instead */
      [part="toolbar"] [part$="button"] {
        background-color: transparent;
        margin: 0 calc(var(--valo-space-s) * -1);
      }

      [part="toolbar"] [part$="button"]:not([focused]) {
        box-shadow: none;
      }

      [part="toolbar"] [part$="button"][active] {
        color: var(--valo-body-text-color);
      }

      [part="toolbar"] [part$="button"][active]::before {
        display: none;
      }

      /* Narrow viewport mode (fullscreen) */

      :host([fullscreen]) {
        max-height: none;
        border-radius: 0;
      }

      [part="overlay-header"] {
        padding: var(--valo-space-s);
        margin-right: 57px;
      }

      /* TODO why is there a forced padding-bottom in the core styles */
      [part="overlay-header"]:not([desktop]) {
        padding: 0;
      }

      :host([fullscreen]) [part="toggle-button"],
      :host([fullscreen]) [part="clear-button"],
      [part="overlay-header"] [part="label"] {
        display: none;
      }

      /* Very narrow screen (year scroller initially hidden) */

      [part="years-toggle-button"] {
        top: 0;
        right: 0;
        bottom: auto;
        padding: var(--valo-space-s);
        color: var(--valo-primary-text-color);
        text-align: right;
        flex: 1;
      }

      [part="years-toggle-button"]::after {
        content: "";
        position: absolute;
        z-index: -1;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background-color: var(--valo-base-color);
        filter: blur(8px);
      }

      [part="years-toggle-button"]::before {
        content: none;
      }

      /* TODO magic number (same as used for iron-media-query in vaadin-date-picker-overlay) */
      @media screen and (max-width: 374px) {
        :host {
          background-image: none;
        }

        [part="years"] {
          background-color: var(--valo-shade-5pct);
        }

        [part="overlay-header"] {
          margin-right: 0;
        }

        :host(:not([years-visible])) [part="toolbar"] {
          right: 0;
        }

        /* TODO make date-picker adapt to the width of the years part */
        [part="years"] {
          --vaadin-infinite-scroller-buffer-width: 90px;
          width: 50px;
        }

        :host([years-visible]) [part="months"] {
          padding-left: 50px;
        }
      }
    </style>
  </template>
</dom-module>
